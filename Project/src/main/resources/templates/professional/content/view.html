<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <title th:text="|Ver: ${content.name}|">Visualizar Conteúdo</title>
</head>

<main layout:fragment="content" class="pt-24 pb-12">
    <div class="container mx-auto px-4 max-w-4xl">

        <div class="mb-8">
            <h1 class="text-4xl font-bold text-foreground" th:text="${content.name}"></h1>
            <p class="text-lg text-muted-foreground mt-2" th:text="${content.description}"></p>
            <div class="flex items-center gap-2 mt-6">
                 <a th:href="@{/professional/content/edit/{id}(id=${content.id})}"
                    class="inline-flex items-center justify-center px-6 py-2.5 h-10 rounded-md bg-accent hover:bg-accent/90 text-accent-foreground font-medium transition-colors">
                     Editar
                 </a>
                 <form th:action="@{/professional/content/delete/{id}(id=${content.id})}" method="post" onsubmit="return confirm('Tem certeza que deseja remover este conteúdo?')">
                     <button type="submit"
                             class="inline-flex items-center justify-center px-6 py-2.5 h-10 rounded-md bg-destructive/10 hover:bg-destructive/20 text-destructive font-medium transition-colors">
                         Remover
                     </button>
                 </form>
            </div>
        </div>

        <div th:switch="${content.contentType?.name()}">

            <!-- ======================= -->
            <!-- Caso 1: ROTINA (Preview)-->
            <!-- ======================= -->
            <div th:case="'ROUTINE'" th:with="routine=${content}">
                
                <div class="bg-card border border-border rounded-xl shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-semibold text-foreground mb-6">Detalhes da Rotina</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-muted-foreground mb-1">Nível</label>
                            <p class="text-lg text-foreground" th:text="${routine.routineLevel}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-muted-foreground mb-1">Objetivo</label>
                            <div class="flex flex-wrap gap-2">
                                <span th:each="goal : ${routine.goals}" th:text="${goal}"
                                      class="px-3 py-1 rounded-full bg-primary/10 text-primary text-sm font-medium">
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 class="text-3xl font-semibold text-foreground mb-6">Treinos da Rotina</h2>
                <div class="space-y-6">
                    <div th:each="training : ${routine.trainings}" 
                         class="bg-card border border-border rounded-xl shadow-lg p-8">
                        
                        <h3 class="text-2xl font-bold text-primary mb-4" th:text="${training.name}"></h3>
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span th:each="group : ${training.targetMuscleGroups}" th:text="${group}"
                                  class="px-2 py-0.5 rounded-full bg-accent/10 text-accent text-xs font-medium">
                            </span>
                        </div>
                        <div class="space-y-4">
                            <div th:each="set : ${training.trainingSets}" class="border-b border-border pb-3 last:border-b-0">
                                <h4 class="text-lg font-semibold text-foreground" th:text="${set.exercise.name}"></h4>
                                <p class="text-muted-foreground">
                                    <span th:text="${set.sets}"></span> séries x 
                                    <span th:text="${set.repetitions}"></span> reps 
                                    (<span th:text="${set.restTimeSeconds}"></span>s descanso)
                                </p>
                                <small class="text-accent" th:if="${set.technique}" th:text="${set.technique}"></small>
                                <div classf="text-sm text-muted-foreground mt-1">
                                    <span th:if="${set.loadInKg}" th:text="|Carga: ${set.loadInKg}kg  |" class="mr-2"></span>
                                    <span th:if="${set.durationSeconds}" th:text="|Duração: ${set.durationSeconds}s|"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- Caso 2: DIETA (Preview) -->
            <!-- ======================= -->
            <div th:case="'DIET'" th:with="diet=${content}">
                <div class="bg-card border border-border rounded-xl shadow-lg p-8">
                    <div>
                        <label class="block text-sm font-medium text-muted-foreground mb-2">Plano Alimentar</label>
                        <div class="prose prose-invert max-w-none bg-background p-4 rounded-md border border-border"
                             th:utext="${#strings.replace(diet.mealsEspecifications, T(java.lang.System).getProperty('line.separator'), '&lt;br/&gt;')}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- Caso 3: MATERIAL (Preview) -->
            <!-- ======================= -->
            <div th:case="'MATERIAL'" th:with="material=${content}">
                 <div class="bg-card border border-border rounded-xl shadow-lg p-8">
                    <div class="flex flex-wrap gap-2 mb-6">
                        <span th:each="tag : ${material.tags}" th:text="${tag}"
                              class="px-3 py-1 rounded-full bg-accent/10 text-accent text-sm font-medium">
                        </span>
                    </div>
                     
                    <!-- *** CORRIGIDO DE .content PARA .value *** -->
                    <div class="space-y-6">
                        <div th:each="block : ${material.contentBlocks}">
                            <div th:if="${block.type == 'TEXT'}">
                                <p class="text-foreground" th:utext="${#strings.replace(block.value, T(java.lang.System).getProperty('line.separator'), '&lt;br/&gt;')}"></p>
                            </div>
                            <div th:if="${block.type == 'IMAGE'}">
                                <img th:src="${block.value}" alt="Imagem do material" class="w-full h-auto rounded-md border border-border"/>
                            </div>
                            <div th:if="${block.type == 'VIDEO'}" class="aspect-video">
                                <iframe class="w-full h-full rounded-md border border-border" 
                                        th:src="${block.value}" 
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                        allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>
                 </div>
            </div>

            <div th:case="*">
                <p class="text-muted-foreground">Tipo de conteúdo não reconhecido.</p>
            </div>
        </div>

    </div>
</main>
</html>